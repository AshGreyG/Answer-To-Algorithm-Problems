---
tags:
  - computer-science
  - algorithm
  - algorithm-combination
  - algorithm-dp
  - algorithm-counting-dp
  - combinatorics
  - python
date: 2025-11-25
---

# 洛谷 P1044 栈-Catalan数 | Python Week

## 1 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/5qxy9fz2.png)

宁宁考虑的是这样一个问题：一个操作数序列，$1,2,\ldots ,n$（图示为 1 到 3 的情况），栈 A 的深度大于 $n$。

现在可以进行两种操作，

1. 将一个数，从操作数序列的头端移到栈的头端（对应数据结构栈的 push 操作）
2. 将一个数，从栈的头端移到输出序列的尾端（对应数据结构栈的 pop 操作）

使用这两种操作，由一个操作数序列就可以得到一系列的输出序列，下图所示为由 `1 2 3` 生成序列 `2 3 1` 的过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/8uwv2pa2.png)

（原始状态如上图所示）

你的程序将对给定的 $n$，计算并输出由操作数序列 $1,2,\ldots,n$ 经过操作可能得到的输出序列的总数。

### 1.1 输入格式

输入文件只含一个整数 $n$（$1 \leq n \leq 18$）。

### 1.2 输出格式

输出文件只有一行，即可能输出序列的总数目。

### 1.3 输入输出样例 #1

#### 1.3.1 输入 #1

```
3
```

#### 1.3.2 输出 #1

```
5
```

### 1.4 说明/提示

**【题目来源】**

NOIP 2003 普及组第三题

## 2 分析

### 2.1 题面分析

本题实际来自一个经典的组合计数问题：一列火车 $1, 2, \cdots, n$ 进入
车站，车站只有一个栈轨道。每节车厢可以选择直接出站（出栈）或者入站（
入栈，等待后续再出）。问一共有多少合法的出栈顺序。这个模型相当于一个合
法的括号匹配序列个数，记入栈操作为 `(`，出栈操作为 `)`。则问题就是
合法的不会空弹的括号序列，例如 `(()(()))`。

在本问题中，`1` 是最早进入栈的，同时它会在某一个时刻出栈，假设其出栈时
栈内恰好已经出栈了 $i$ 个元素，由于在这 $i$ 个元素进出栈时，已经在栈
底的元素 `1` 可以忽略，即成为了栈的一部分。因此处理这 $i$ 个元素时
所有可能的出栈顺序个数为 $\text{dp}[i]$。同时，在 `1` 出栈之后的
$n - i - 1$ 个元素中，其所有可能的出栈顺序个数为 $\text{dp}[n - i - 1]$，
因此根据组合计数的乘法原理和加法原理我们可以得到

$$
  \text{dp}[n] = \sum_{i = 0}^{n - 1}
    \text{dp}[i]\cdot\text{dp}[n - i - 1]
$$

### 2.2 算法实现-动态规划

根据上面给出的状态转移方程可以很快地给出算法实现：

``` python
if __name__ == "__main__" :
    n = int(input().rstrip())
    dp : List[int] = [0] * (n + 1)
    dp[0] = 1
    dp[1] = 1

    for i in range(2, n + 1) :
        for k in range(i) :
            dp[i] += dp[k] * dp[i - k - 1]

    print(dp[n])
```

<!-- TODO: Proof of Catalan number -->